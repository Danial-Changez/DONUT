@startuml Scan Sequence Diagram
actor User
participant "HomeView" as View
participant "HomePresenter" as Presenter
participant "ScanService" as Scan
participant "AsyncJob" as Job
participant "ExecutionService" as Exec
participant "NetworkProbe" as Net
participant "RunspaceManager" as Pool

User -> View: Clicks "Scan"
View -> Presenter: OnSearch()
activate Presenter

Presenter -> Presenter: Parse hostnames from input
Presenter -> Presenter: Validate host count

loop For each hostname
    Presenter -> Scan: PrepareScan("PC-01")
    activate Scan

    Scan -> Scan: ValidateHostConnectivity("PC-01")
    Scan -> Net: ResolveHost("PC-01")
    Net --> Scan: IPAddress
    Scan -> Net: CheckReverseDNS(ip, "PC-01")
    Net --> Scan: true/false (warning only)
    
    Scan -> Scan: BuildWorkerArgs("PC-01", "Scan", {})
    Scan --> Presenter: JobParams (scriptPath, arguments)
    deactivate Scan

    Presenter -> Pool: GetPool()
    Pool --> Presenter: RunspacePool
    
    Presenter -> Job: new AsyncJob("PC-01", "Scan")
    Presenter -> Job: Start(scriptPath, arguments, configPath)
    activate Job
    Job --> Presenter: (async started)
    deactivate Job
end

Presenter -> View: UpdateStatus("Scanning...")
deactivate Presenter

loop Timer tick (500ms)
    Presenter -> Job: Poll()
    activate Job
    
    alt Job completed
        Job -> Exec: StartWorker("PC-01", "Scan", Options, Config, ...)
        activate Exec
        Exec -> Exec: RunScanPhase(DeviceContext)
        Exec -> Net: IsOnline("PC-01")
        Net --> Exec: true
        Exec -> Exec: InvokePsExec(...)
        note right: Runs DCU-CLI via PsExec
        Exec -> Exec: CopyRemoteArtifacts(...)
        Exec --> Job: ScanResults
        deactivate Exec
        Job --> Presenter: Status = "Completed"
    else Job still running
        Job --> Presenter: Status = "Running"
    end
    deactivate Job
end

Presenter -> Presenter: ProcessJobResults()
Presenter -> View: DisplayResults(ScanResults)
@enduml
